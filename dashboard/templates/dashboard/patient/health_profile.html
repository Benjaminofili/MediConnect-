{% extends 'dashboard/base_patient.html' %}
{% load static %}

{% block title %}Health Profile{% endblock %}

{% block content %}
<div class="content">
    <div class="mb-3 border-bottom pb-3">
        <h4 class="fw-bold mb-0">Health Profile</h4>
        <p class="text-muted mb-0">Manage your complete medical information</p>
    </div>
    
    <div class="card">
        <div class="card-body">
            <div class="row">
              <!-- Include Sidebar Partial -->
                {% include 'dashboard/partials/_settings_sidebar.html' %}

                <!-- Main Content -->
                <div class="col-lg-9">
                    <div class="border-1 border-start ps-4">
                        
                        <form action="" method="POST">
                            {% csrf_token %}
                            
                            <!-- BMI Card -->
                            {% if profile.bmi %}
                            <div class="alert alert-info mb-4">
                                <div class="d-flex align-items-center">
                                    <i class="ti ti-scale fs-3 me-3"></i>
                                    <div>
                                        <strong>Your BMI: {{ profile.bmi }}</strong>
                                        <span class="ms-2">
                                            {% if profile.bmi < 18.5 %}
                                                (Underweight)
                                            {% elif profile.bmi < 25 %}
                                                (Normal)
                                            {% elif profile.bmi < 30 %}
                                                (Overweight)
                                            {% else %}
                                                (Obese)
                                            {% endif %}
                                        </span>
                                    </div>
                                </div>
                            </div>
                            {% endif %}
                            
                            <!-- Physical Information -->
                            <h5 class="fw-bold pb-3 mb-4 border-1 border-bottom">
                                <i class="ti ti-ruler-measure me-2 text-primary"></i> Physical Information
                            </h5>
                            
                            <div class="row border-bottom mb-3 pb-3">
                                <div class="col-lg-6">
                                    <div class="row align-items-center mb-3">
                                        <div class="col-lg-4">
                                            <label class="form-label mb-0">Blood Type</label>
                                        </div>
                                        <div class="col-lg-8">
                                            <select name="blood_type" class="form-select">
                                                {% for value, label in form.fields.blood_type.choices %}
                                                <option value="{{ value }}" {% if profile.blood_type == value %}selected{% endif %}>{{ label }}</option>
                                                {% endfor %}
                                            </select>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-lg-6">
                                    <div class="row align-items-center mb-3">
                                        <div class="col-lg-4">
                                            <label class="form-label mb-0">Height (cm)</label>
                                        </div>
                                        <div class="col-lg-8">
                                            <input type="number" step="0.01" name="height_cm" class="form-control" value="{{ profile.height_cm|default:'' }}" placeholder="e.g., 170">
                                        </div>
                                    </div>
                                </div>

                                <div class="col-lg-6">
                                    <div class="row align-items-center mb-3">
                                        <div class="col-lg-4">
                                            <label class="form-label mb-0">Weight (kg)</label>
                                        </div>
                                        <div class="col-lg-8">
                                            <input type="number" step="0.01" name="weight_kg" class="form-control" value="{{ profile.weight_kg|default:'' }}" placeholder="e.g., 70">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Quick Medical Summary -->
                            <h5 class="fw-bold pb-3 mb-4 border-1 border-bottom">
                                <i class="ti ti-notes me-2 text-primary"></i> Quick Medical Summary
                            </h5>

                            <div class="row border-bottom mb-3 pb-3">
                                <!-- Allergies -->
                                <div class="col-lg-12">
                                    <div class="row mb-3">
                                        <div class="col-lg-2">
                                            <label class="form-label mb-0 pt-2">
                                                <i class="ti ti-alert-circle text-danger me-1"></i> Allergies
                                            </label>
                                        </div>
                                        <div class="col-lg-10">
                                            <textarea class="form-control" name="allergies" rows="2" 
                                                placeholder="e.g., Penicillin, Peanuts, Latex">{{ profile.allergies }}</textarea>
                                        </div>
                                    </div>
                                </div>

                                <!-- Chronic Conditions -->
                                <div class="col-lg-12">
                                    <div class="row mb-3">
                                        <div class="col-lg-2">
                                            <label class="form-label mb-0 pt-2">Chronic Conditions</label>
                                        </div>
                                        <div class="col-lg-10">
                                            <textarea class="form-control" name="chronic_conditions" rows="2" 
                                                placeholder="e.g., Diabetes Type 2, Hypertension">{{ profile.chronic_conditions }}</textarea>
                                        </div>
                                    </div>
                                </div>

                                <!-- Current Medications -->
                                <div class="col-lg-12">
                                    <div class="row mb-3">
                                        <div class="col-lg-2">
                                            <label class="form-label mb-0 pt-2">Current Medications</label>
                                        </div>
                                        <div class="col-lg-10">
                                            <textarea class="form-control" name="current_medications" rows="2" 
                                                placeholder="e.g., Metformin 500mg twice daily">{{ profile.current_medications }}</textarea>
                                        </div>
                                    </div>
                                </div>

                                <!-- Family History -->
                                <div class="col-lg-12">
                                    <div class="row mb-3">
                                        <div class="col-lg-2">
                                            <label class="form-label mb-0 pt-2">Family History</label>
                                        </div>
                                        <div class="col-lg-10">
                                            <textarea class="form-control" name="family_history" rows="2" 
                                                placeholder="e.g., Father - Heart Disease, Mother - Diabetes">{{ profile.family_history }}</textarea>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Link to Detailed Timeline -->
                            <div class="alert alert-primary d-flex justify-content-between align-items-center mb-4">
                                <div>
                                    <i class="ti ti-history me-2"></i>
                                    <strong>Detailed Medical Timeline</strong>
                                    <span class="d-block d-md-inline text-muted ms-md-2">
                                        Track surgeries, diagnoses, vaccinations with dates & details
                                    </span>
                                </div>
                                <a href="{% url 'dashboard:patient_medical_history' %}" class="btn btn-primary btn-sm">
                                    <i class="ti ti-arrow-right me-1"></i> View Timeline
                                </a>
                            </div>

                            <!-- Lifestyle -->
                            <h5 class="fw-bold pb-3 mb-4 border-1 border-bottom">
                                <i class="ti ti-heart me-2 text-primary"></i> Lifestyle
                            </h5>
                            
                            <div class="row border-bottom mb-3 pb-3">
                                <div class="col-lg-6">
                                    <div class="row align-items-center mb-3">
                                        <div class="col-lg-4">
                                            <label class="form-label mb-0">Smoking Status</label>
                                        </div>
                                        <div class="col-lg-8">
                                            <select name="smoking_status" class="form-select">
                                                {% for value, label in form.fields.smoking_status.choices %}
                                                <option value="{{ value }}" {% if profile.smoking_status == value %}selected{% endif %}>{{ label }}</option>
                                                {% endfor %}
                                            </select>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-lg-6">
                                    <div class="row align-items-center mb-3">
                                        <div class="col-lg-4">
                                            <label class="form-label mb-0">Alcohol</label>
                                        </div>
                                        <div class="col-lg-8">
                                            <select name="alcohol_consumption" class="form-select">
                                                {% for value, label in form.fields.alcohol_consumption.choices %}
                                                <option value="{{ value }}" {% if profile.alcohol_consumption == value %}selected{% endif %}>{{ label }}</option>
                                                {% endfor %}
                                            </select>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-lg-6">
                                    <div class="row align-items-center mb-3">
                                        <div class="col-lg-4">
                                            <label class="form-label mb-0">Exercise</label>
                                        </div>
                                        <div class="col-lg-8">
                                            <input type="text" class="form-control" name="exercise_frequency" value="{{ profile.exercise_frequency }}" placeholder="e.g., 3 times per week">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Emergency Contact -->
                            <h5 class="fw-bold pb-3 mb-4 border-1 border-bottom">
                                <i class="ti ti-phone-call me-2 text-danger"></i> Emergency Contact
                            </h5>
                            
                            <div class="row border-bottom mb-3 pb-3">
                                <div class="col-lg-6">
                                    <div class="row align-items-center mb-3">
                                        <div class="col-lg-4">
                                            <label class="form-label mb-0">Name</label>
                                        </div>
                                        <div class="col-lg-8">
                                            <input type="text" class="form-control" name="emergency_contact_name" value="{{ profile.emergency_contact_name }}" placeholder="Full name">
                                        </div>
                                    </div>
                                </div>

                                <div class="col-lg-6">
                                    <div class="row align-items-center mb-3">
                                        <div class="col-lg-4">
                                            <label class="form-label mb-0">Phone</label>
                                        </div>
                                        <div class="col-lg-8">
                                            <input type="text" class="form-control" name="emergency_contact_phone" value="{{ profile.emergency_contact_phone }}" placeholder="Phone number">
                                        </div>
                                    </div>
                                </div>

                                <div class="col-lg-6">
                                    <div class="row align-items-center mb-3">
                                        <div class="col-lg-4">
                                            <label class="form-label mb-0">Relationship</label>
                                        </div>
                                        <div class="col-lg-8">
                                            <input type="text" class="form-control" name="emergency_contact_relationship" value="{{ profile.emergency_contact_relationship }}" placeholder="e.g., Spouse, Parent">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Insurance -->
                            <h5 class="fw-bold pb-3 mb-4 border-1 border-bottom">
                                <i class="ti ti-shield-check me-2 text-success"></i> Insurance Information
                            </h5>
                            
                            <div class="row mb-3">
                                <div class="col-lg-6">
                                    <div class="row align-items-center mb-3">
                                        <div class="col-lg-4">
                                            <label class="form-label mb-0">Provider</label>
                                        </div>
                                        <div class="col-lg-8">
                                            <input type="text" class="form-control" name="insurance_provider" value="{{ profile.insurance_provider }}" placeholder="Insurance company name">
                                        </div>
                                    </div>
                                </div>

                                <div class="col-lg-6">
                                    <div class="row align-items-center mb-3">
                                        <div class="col-lg-4">
                                            <label class="form-label mb-0">Policy Number</label>
                                        </div>
                                        <div class="col-lg-8">
                                            <input type="text" class="form-control" name="insurance_policy_number" value="{{ profile.insurance_policy_number }}" placeholder="Policy/Member ID">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Submit Buttons -->
                            <div class="d-flex justify-content-end align-items-center gap-2 mt-4">
                                <a href="{% url 'dashboard:patient_dashboard' %}" class="btn btn-light btn-md fs-13 fw-medium rounded">Cancel</a>
                                <button type="submit" class="btn btn-primary btn-md fs-13 fw-medium rounded">
                                    <i class="ti ti-device-floppy me-1"></i> Save Changes
                                </button>
                            </div>
                        </form>
                    </div>
                </div> 
            </div>
        </div>
    </div>
</div>
{% endblock %}